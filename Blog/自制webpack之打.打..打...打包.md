# è‡ªåˆ¶webpackä¹‹ æ‰“.æ‰“..æ‰“...æ‰“åŒ…
![1](./img/è‡ªåˆ¶webpackä¹‹æ‰“.æ‰“..æ‰“...æ‰“åŒ…/1.jpg)

ğŸ¤¡ è‡ªå·±ç®€å•å®ç°çš„ webpack(ä¼ª) ğŸ¤¡

ğŸ¤£ å¹¶æ²¡æœ‰ `Tapable` ğŸ¤£

ğŸ˜œ æ‰€ä»¥ä¹Ÿå¹¶æ²¡æœ‰å®ç°çœŸæ­£çš„`webpack` ğŸ˜œ

ğŸ¤– å°±åªæ˜¯ä¸€ä¸ªè¿æ‰“åŒ…éƒ½å¯èƒ½æœ‰ğŸ’© `bug` ğŸ’©çš„å°ç©å…· ğŸ¤–

ğŸ™ å¦‚æœä½ æœ‰å¹¸ç©å‡ºäº†ğŸ’© `bug` ğŸ’©ï¼Œ è¯·ä¸€å®šè¦æğŸ˜ˆ `issue` ğŸ˜ˆå“¦ ğŸ™

#### åŸºæœ¬æµç¨‹

1. ç”Ÿæˆé…ç½®

  &emsp;&emsp;-> æ ¹æ® `å‘½ä»¤è¡Œå‚æ•°` å’Œ `é…ç½®æ–‡ä»¶` ç”Ÿæˆæœ€ç»ˆå¯ç”¨çš„é…ç½®

2. å¼€å§‹æ‰“åŒ…

  &emsp;&emsp;-> æ‰¾åˆ°å…¥å£æ–‡ä»¶å¹¶ä»å…¥å£æ–‡ä»¶å¼€å§‹è§£ææ–‡ä»¶

3. é€šè¿‡ `parse.js` è§£ææ–‡ä»¶

  &emsp;&emsp;-> å…ˆé€šè¿‡ `resolve.js` æ‰¾åˆ°æ–‡ä»¶çš„å®é™…ä½ç½®ï¼Œä¹Ÿå°±æ˜¯ç»å¯¹è·¯å¾„ï¼Œè®°å½•åœ¨ `filePath` å­—æ®µä¸­

  &emsp;&emsp;-> è¯»å–è·¯å¾„ä¸‹çš„æ–‡ä»¶å†…å®¹ï¼Œç”¨ `babylon` è½¬æ¢æˆä¸º `AST`

  &emsp;&emsp;-> `@babel/traverse` éå† `AST`ï¼Œè·å–å¼•å…¥çš„æ¨¡å—åˆ—è¡¨ï¼Œè®°å½•åœ¨ `dependencies` å­—æ®µä¸­

  &emsp;&emsp;-> `@babel/core` å°† `AST` è½¬ä¸º `ES5`ï¼Œè®°å½•åœ¨ `code` å­—æ®µä¸­

  &emsp;&emsp;-> æœ€ç»ˆè¿”å›è®°å½•äº†å½“å‰æ–‡ä»¶ä¿¡æ¯çš„å¯¹è±¡ `{filePath, dependencies, code}`

4. æ·±åº¦ä¼˜å…ˆéå† `dependencies` ä¸­çš„æ¨¡å—ï¼Œæ‰§è¡Œç¬¬3æ­¥è§£ææ–‡ä»¶çš„é€»è¾‘

  &emsp;&emsp;-> ç”¨ `queue` å­˜å‚¨éå†çš„ç»“æœ

5. æ‰§è¡Œ `bundle.js`ï¼Œå¯¹è§£æçš„ç»“æœï¼ˆ`queue`ï¼‰ æ‰“åŒ…

  &emsp;&emsp;-> å°†å„ä¸ªæ¨¡å—çš„ä»£ç è¿›è¡Œæ‹¼æ¥ï¼Œç”Ÿæˆæœ€ç»ˆå¯æ‰§è¡Œçš„ï¼Œç¬¦åˆCommonJSè§„èŒƒçš„ï¼Œå¯åœ¨æµè§ˆå™¨æ‰§è¡Œçš„ä¸€ä¸ª(ç›®å‰æ‰“åŒ…åªåšäº†å•æ–‡ä»¶çš„)JSæ–‡ä»¶

6. å°†ç»“æœå†™å…¥åˆ°é…ç½®çš„è¾“å‡ºç›®å½•ä¸­

   

##### `resolve.js`æŸ¥æ‰¾æ¨¡å—ä½ç½®çš„é€»è¾‘

&emsp;&emsp;-> ç»å¯¹è·¯å¾„ ç›´æ¥é‡‡ç”¨ï¼Œè‡ªåŠ¨è¡¥å…¨ `.js` åç¼€

&emsp;&emsp;-> ç›¸å¯¹è·¯å¾„ æ ¹æ®å½“å‰æ–‡ä»¶çš„ä½ç½® `context` æŸ¥æ‰¾æ–‡ä»¶

&emsp;&emsp;-> å…¶ä»–çš„å‘½åï¼Œè§†ä¸ºæ¨¡å—åå­—

&emsp;&emsp;&emsp;&emsp;-> åŸºäºå½“å‰æ–‡ä»¶ä½ç½®ï¼Œé€å±‚å¾€ä¸Šçš„ä¾æ¬¡æŸ¥æ‰¾ å½“å‰ç›®å½•ï¼Œ`node_modules` å’Œ `node_modules` ä¸‹çš„ `loader`

##### ASTè¯­æ³•è½¬æ¢ç›¸å…³

- [babel/parser](https://babeljs.io/docs/en/babel-parser) è§£æè¯­æ³• ç”ŸæˆAST
- [babel/traverse](https://babeljs.io/docs/en/babel-traverse) éå†AST åˆ†æè®°å½•ä¾èµ–å…³ç³»
- [babel/core](https://babeljs.io/docs/en/babel-core) babel.transformFromAst + [babel/preset-env](https://babeljs.io/docs/en/babel-preset-env) å°†ASTè½¬æ¢ä¸ºES5 JavaScript

#### å¦‚ä½•è¿è¡Œ

```shell
yarn
yarn link
y-webpack
```
